---
layout:     post
title:      自适应和移动辅助削减二进制能量对偶
subtitle:   
date:       2018-02-20
author:     WMX
header-img: img/post-bg-os-metro.jpg
catalog: true
tags:
    - 能量对偶
    - 二进制
    - 辅助功能
---
源自论文《Adaptive and Move Making Auxiliary Cuts for Binary Pairwise Energies》

# 摘要

许多计算机视觉问题需要优化二元非次（子）模块能量。 
在这种情况下，最近提出了基于信任区域（LSA-TR）和辅助功能（LSA-AUX）的局部迭代次模化技术。 他们在许多计算机视觉应用上获得了最先进的成果。

在本文中，我们将LSA-AUX框架向两个方向扩展。
首先，与仅基于当前解决方案选择辅助功能的LSA-AUX不同，我们建议纳入若干 附加标准 来选择自适应上限，如通过单项偏好，高能偏好。
其次，我们提出通过限制搜索空间来实现更紧密边界的LSA-AUX的移动扩展。
第一种类型是基于α扩展，当前的解决方案允许增长或收缩，这可能会使某些配置无效。 因此，在选择上限时可以忽略它们，从而为余下的配置提供更严格的界限。 
第二种类型的移动是基于分段边界的几何形状。 每一步都准确地模拟了某个方向上的边界变化，并且我们重复这些方向。。

实验效果是，在几个应用程序上评估我们的方法，对于每个应用程序，我们的扩展至少有一个显著优于原始的LSA-AUX。 
此外，LSA-AUX的最佳扩展在六个应用中的四个应用和LSA-TR相比具有同样的效果甚至更佳。

# 介绍

LSA-TR基于信任域框架。在每次迭代中，它使用次模函数逼近当前解决方案周围的原始能量。近似值仅在当前解决方案周围的一个小区域被信任，称为信任区域。
下一个候选解决方案是通过全局优化该信任区域内的近似来获得的。然后根据近似的质量增加或减少信任区域大小，从而更好地控制步长问题

LSA-AUX基于辅助功能框架，也称为绑定优化。 它是一类迭代算法，在每次迭代中构造并优化（全局最小化）原始解的上界。
无需控制步长，因为全局最小值保证降低原始能量。

# 自适应辅助函数

令（stp，stq）为当前解st中像素p和q的配置。下表为stp，stq四种可能配置的上限

![表1](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/4fae08c54094cec180dfbc6829b24ec8.png)

如果没有额外的信息，就不清楚表1中第1,4行的两个同样紧密的边界βsp和βsq中的哪一个更适合配置。
一种方法是在这两种情况下随机选择βsp或βsq。 这正是基于置换的方法在高阶超模结构的情况下提出的，当它降低到成对电势时。 我们称之为LSA-AUX-P。 
另一种方法是在某种意义上决定配置（0,1）还是（1,0）更可能。 如果配置（0，1）更有可能，我们选择边界βsp，否则选择βsq。 通过这种方式，选择的边界与更可能的配置中的原始配对电势重合。

下面是几种选择标准，会产生不同的辅助切割算法。

## 一元偏好

决定两个配置（0,1）或（1,0）中哪个可能性大的最简单方法是看一元项。让U是一元系数的向量。如果像素p与像素q相比有更强的偏好，那就是up> uq，我们说配置（sp，sq）=（0,1）比（1,0）更可能，并且选择边界βsp。
我们将这种版本的LSA-AUX称为AUX-U。下表列出了选择标准的所有情况以及结构（0，0）和（1,1）的结果界限：
![](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/603681664046d4d18037db74e640342a.png)

## ICM偏好

在界限βspβsq之间进行选择的更多参与方式受到并行ICM（iterated Conditional Modes）原理的启发。在ICM中，给定当前解决方案St，我们固定除一个之外的所有标签并优化其余变量。在并行ICM中，这对于所有变量都是同时完成的，从而产生线性逼近函数，这可以被有效地优化。为了选择自适应上限，我们使用了一些变量对。
给定超模态势β·spsq，我们将除sp和sq之外的所有变量修正为当前解St。然后，我们评估解决方案St的能量E，首先代入（sp，sq）=（0,1），然后（sp，sq） =（1,0），分别由S01t和S10t表示。 选择较低能量的配置来精确建模。 对于所有超模电位，这是同时完成的。我们将此版本的LSA-AUX称为AUX-ICM，并在下表中为每种情况指定选定的边界。

![](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/4db9123640265d3380620b8cf779fdd5.jpg)

## 与当前解决方案St的距离
决定哪个配置（0，1）或（1,0）应该精确建模的另一种方法是基于与当前解决方案的距离。 
考虑超模态势β·spsq并假设Dt =（dtp | p∈Ω）是从每个像素到当前解的边界的最短距离的向量.我们说更接近边界的变化比离它更远的变化更可取。 假设当前的配置（stp，stq）=（0,0）。如果像素p比像素q更接近边界，即dtp <dtq，我们倾向于精确地建模其中p改变其标签而不是q的配置。也就是说，我们选择配置（1，0）。同样，如果当前配置是（stp，stq）=（1,1），并且像素p比像素q更接近边界，我们选择准确建模配置（0,1）。 
下表列出了所有情况以及由此产生的结构边界（stp，stq）=（0,0）和（stp，stq）=（1,1）：
![](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/e04de77240a553078091873758bbd9ec.jpg)

我们将基于距离的LSA-AUX版本称为AUX-DIST。
距离为基础的解决方案是非常好的，结合距离标准与一元偏好我们可以得到一个额外的子集。 在这个子集中，候选解决方案偏离基于一元偏好的距离变换的水平集。 我们将这种版本的LSA-AUX称为AUX-DIST-U。 下表列出了选择标准和结构（0，0）和（1，1）的结果界限：

![](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/704da2aa40d93a78803576f2e5f12985.jpg)

## 超模邻域的大小

另一种在边界之间进行选择的方法是基于超模块邻域的大小。
给定当前的解决方案St，我们可以测量每个像素p在前景中具有r的超模电位（p，r）的数目ntp：![](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/3c69f64440a39648804d649614bba943.jpg )  (9)
考虑超模态势（p，q）。如果两个像素都处于前景中并且（ntp> ntq），这意味着在大多数情况下q更接近边界。因此，我们模型精确配置（1，0），其中p保持不变。如果两个像素都在背景中并且（ntp> ntq），则意味着p更接近边界。因此，我们准确地建模配置（1，0），其中q保持不变。远离边界的像素的ntp值为零（在背景中）或超模块邻域的大小（在对象内）。下表列出了选择标准以及构造（0,0）和（1,1）的结果界限：
![](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/cfb0901e403dc39c806fcda2c07ebdbe.png)

在实验中，我们使用（9）的加权版本，即ntp =Σ（r∈Np）∧（mpr> 0）mpr·str，因为它在实践中作用一直很好。我们将此版本的LSA-AUX称为AUX-SNS。

# 移动辅助切割

受多标记和二元能量背景下的移动算法的启发，下面我们提出两种类型的二元移动扩展。 与自适应边界方法相反，在自适应边界方法中，寻找对某些配置精确的上限，而移动扩展可以获得更好的性能，通过显式或隐式地限制搜索空间。

## α膨胀辅助切割

第一种类型是基于α扩展。当前的解决方案允许增长或收缩，这样的移动会使某些配置无效，从而允许通过近似精确地建模剩余的有效配置。在每个α扩展运动中，严格限制当前具有标签α的所有变量并运行辅助切割方法直至收敛。 重复α交替的过程直到收敛。注意，α-扩展可以与LSA-AUX 和前面介绍的任何自适应辅助切割结合使用。

![图2](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/0cb1053f40d2fd1180240bcf228c43d0.png )

图2展示了限制辅助裁剪搜索空间的优势。这些列对应于当前解决方案中成对电位（stp，stq）的四种可能配置。这些行对应于候选解决方案中潜在的四种配置（sp，sq）。根据当前的配置，在每种方法中选择一个合适的界限（每个部分的绿线）。如果有两种选择，则在括号中指定替代方案。然后指定它是否精确近似或不适用于候选解中每个可能的（sp，sq）配置。
可以看出，LSA-AUX（黄色）在16个案例中十个是精确的。 自适应辅助切割（灰色）在16个案例中有十二个是精确的。 最后，自适应方法（蓝色和粉红色）的α展开在9个案例中有8个是精确的，因为一些配置是无效的。
每当我们使用自适应辅助函数中提出的任何方法进行扩展移动时，我们都会在其名称后添加-EXP后缀。例如，当AUX-U与扩展移动一起使用时，我们称之为AUX-U-EXP。

## 罗盘移动

第二种类型的移动是基于分段边界的几何形状。 它受到在多标签能量背景下提出的保序动作的启发。 
为了保留移动，每个像素根据移动的方向在选定的一组标签上扩展。相反，在每个指南针移动中，选择一个方向（上，下，左，右），对于该方向上的所有超模成对电位，我们选择配置（1,0）以便通过上限精确建模。 这允许沿着顶部，底部，左侧或右侧边界的变化的精确上限。 我们继续交替移动，并且对于每个移动，我们都会进行辅助裁剪直到收敛。 我们称这种方法为罗盘移动。

![图3](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/7d77a73c400d1bcd8026c94a62a8e219.png)

图3（顶部）显示了一个小例子的罗盘移动。考虑方向向右。 对于其中q在p右侧的任何超模态势（p，q），我们精确地建模配置（sp，sq）=（1,0）。 像素q的可能位置的条纹区域种类w.r.t. 像素p。 请注意，我们随意决定上面的像素被认为是在右边。 其他方向的处理方式相似。
与基于距离的偏好一样，在当前的解决方案St的情况下，罗盘移动还定义了上界精确的片段的相干族Ct。 图3（底部）显示了familyCt中针对特定解决方案St和方向权限的片段示例。 边界的绿色部分是精确建模的，因为它们与选定的方向对齐。由于E(St) = At(St) 的要求，蓝色部分被精确建模。

请注意，与显式限制搜索空间的展开移动不同，在罗盘移动中，限制是隐含的。以错误的方向进行更改是可能的，但由于它们具有较松散的上限，所以可能性较小。 此版本的辅助切割由AUX-COMPASS表示。

# 应用
将我们的方法应用于平方曲率正则化，来自该论文《Submodularization for binary pairwise energies》的几种基准能量，例如修补，分割与排斥和二元反卷积，以及紧凑和多区域形状先验的分割。 
对于每个应用，我们将提出的自适应和移动扩展与原始LSA-AUX（此处为AUX），其随机置换版本LSA-AUXP（AUXP）和LSA-TR进行比较。 为了完善，我们还将其与其他标准优化方法进行比较，如QPBO，LBP，IPFP，TRWS和SRMP。 除非另有说明，否则所有本地近似方法均将整个域分配到前景进行初始化。 所有全局优化方法运行多达5000次迭代。

## 平方曲率
相对于外观项，曲率项的权重由参数λcurv控制
对于这个应用程序，我们把毕加索的堂吉诃德绘画作为输入。改变重量λcurv并评估所提出的扩展的性能。其中，最好的三种方法与LSA-TR，AUX和AUXP相比较，见图4.

![图4](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/44f1afee4020951b80e14a4c7efaa130.png)

所有的方法都从基于外观项的最大似然解开始。 当超模曲率项的权重增加时，所提出的方法始终优于LSA-TR（蓝线），AUX（红色）和AUXP（绿色）。所有其他标准优化方法，如QPBO，LBP，TRWS，SRMP和IPFP分别为 明显低于所提出的扩展AUX-DIST-U-EXP中最差的。
我们使用高斯（μ= 0，σ= 0.2）和（μ= 1，σ= 0.2）作为前景和背景外观，7×7模板用于角分辨率。

## 汉字修饰

下面我们考虑中文字符绘画的任务dtf-chinesechar。使用由作者提供的一组预训练的一元和成对电势与数据集。 
表2可以看到提出的扩展中最好的三个和先前公布的结果的表现.我们忽略等级低于8的行.AUX-DIST-U排在第二位，但比排名第一的MCBC快了几个数量级。
![表2](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/d902fbce404a41e9804e5fe38937eb09.png )

## 分割与排斥

下面我们考虑基于像素外观和相对位置的吸引和排斥两两潜在分割。 我们使用16邻域系统并且定义如下电势：ω（p，q）=(-Δ（p，q）+ c)/ dist（p，q）。 dist（p，q）表示图像像素p和q之间的距离，Δ（p，q）是它们各自的强度之差。常数c使得相似的近邻吸引，产生次模电位，否则排斥。 λreg是配对项的权重。

![图5](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/da0fda5340326df380b7cfcba7db603d.png)

图5报告了结果。 提议的扩展中最好的三个扩展性能优于AUX，AUXP和除LSA-TR之外的所有标准优化方法。 这是唯一的应用程序，其中许多提议的扩展名不如原始AUX，这表明每个应用程序都需要专门设计的自适应边界。

## 二进制反卷积

考虑一个与均匀3×3过滤器相结合的二值图像，并结合高斯噪声〜N（0，σnoise）。二值反卷积的目标是恢复原始二值图像。 能量被定义为
![](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/5ed7d73740d21ab9800fafb0f90df650.jpg )（10）
其中Np表示围绕像素p的3×3邻域窗口，并且所有的成对相互作用都是超模。
图6报告了结果。 在所提出的扩展中，最好的是AUX-ICM和AUX-U，明显优于原来的AUX和AUXP，但不是LSA-TR。 对于此应用程序，LSA-TR与IPFP共享第一名。 
![图6](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/56cac959406efcca80cf8b14db0cac29.jpg )

## 分割多区域对象

在本节中，我们将重点放在MRI肝脏分割上。 输入图像包含四个肿瘤的肝脏。 这个问题被表述为最小化非次模能量。它采用多区域模型，能够编码区域之间的几何相互作用，如包含和排除。 
肝脏由具有二维变量层的图形建模，对应于肝脏（Fg）和四个肿瘤（A，B，C，D）。 参见图7（a-b）的示意图。 肿瘤内包含肿瘤和肿瘤之间的排斥约束分别使用子模块和超模块层间成对电位来实施。 另外，我们在每一层使用Potts正则化。
图7（c-d）显示了结果。 我们使用涂鸦的外观和硬约束。 最上面的图比较了能源和运行时间方面的方法。 底部情节放大了最有趣的部分。 大多数方法都是针对包含和排除限制的错误解决方案。 LSA-TR，AUX-DIST，AUX-DIST-U实现相同的最低能量，AUX-DIST的速度提高了一个数量级。
![图7](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/511655994075b11e80a16aeb7c767db6.jpg )

## 广义紧凑形状先验

[5] P. Das, O. Veksler, V. Zavadsky, and Y. Boykov. Semiautomatic segmentation with compact shape prior. Image Vision Computing, 27(1-2):206219, 2009. 2, 6, 7, 8
[10] L. Gorelick, Y. Boykov, O. Veksler, I. B. Ayed, and A. Delong.Local submodularization for binary pairwise energies.In PAMI, page accepted, 2017. 1, 5, 7, 8
下面我们将我们的方法应用于[10]中提出的广义紧致形状先验的分割。 在[5]之前的原始紧凑形状将物体划分为由用户提供的围绕给定中心的四个象限。在每个象限内，轮廓必须遵循该象限的允许方向，参见图8（a）。
而不是将物体分成四个象限，广义先验[10]将背景划分为如图8（b）所示的四个区域，对应于标签：左上（TL），右上（TR），底 左（BL），右下（BR）。前景对象（fg）也有标签。 与多区域模型类似，此模型使用具有四个二元图层的图形：TL，TR，BL，BR。 每层只允许使用Potts的特定方向的不连续性。在二进制层的相应节点之间也存在成对的超模排除约束来强制连贯的前景对象。 对于广义模型的示意图，见图8（c-d）。

![图8](http://bmob-cdn-16714.b0.upaiyun.com/2018/03/15/72608ad440bee282804e6dc111353191.jpg)

当[5]中的模型是广义模型[10]的特例时，背景标签之间的过渡是水平和垂直对齐的，如（b）所示。 广义模型不需要这种对齐。 例如，它可以使用（e）中所示的四个区域对（d）中的对象建模。 由于对轮廓方向的限制，无法使用[5]对该对象进行分割。
我们在下面报告结果。 图8（f）显示了输入图像，用户涂鸦和结果出现的术语，然后是每种方法的最后分割。 图8（g）比较了能量和时间方法。 大多数方法都是由于违反方向和一致性约束条件而导致解决方案不佳。 AUX-DIST-U-EXP在更短的时间内获得最低的能量，LSA-TR和AUXDIST-U-EXP是唯一可以优化这种能量的方法。

# 总结

 我们提出了对LSA-AUX框架的两个扩展。
 首先，我们将基于能量和距离的标准合并作为上界选择。 这导致更加可能或更接近当前解决方案的配置更紧密的配置。 
 其次，我们提出了两种LSA-AUX的移动生成扩展，它们通过有限的搜索空间来实现更精确的上界。
我们得出结论：不同的扩展对不同的应用程序工作效率更好，为设计应用程序特定的自适应边界和移动留出空间。 我们还计划将我们的方法扩展到更高阶和多标签的能量。 另外，根据子模块函数理论设计上限会很有趣
